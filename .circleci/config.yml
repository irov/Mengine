version: 2.1

orbs:
  android: circleci/android@0.2.1

jobs:
  build:
    executor: android/android

    steps:
      - checkout
      
      - run:
          name: install CMake
          command: |
            sudo apt-get update
            sudo apt-get install cmake
            sudo apt-get upgrade
            
      - run:
          name: install gradle
          command: |
            sudo apt-get install gradle
            sudo apt upgrade gradle
            
      - run:
          name: download dependencies
          command: |
            pushd build/downloads
            sudo bash downloads_unix.bash
            popd
            
      - run:
          name: build dependencies
          command: |
            pushd build/unix_android_sdl
            sudo bash build_depends_android_sdl_release.bash
            popd
            
      - run:
          name: assemble release
          command: |
            pushd gradle
            chmod +x ./gradlew
            ./gradlew assembleRelease -PANDROID_APP_UPLOAD_CRASHLYTICS=0 -PANDROID_APP_ABI_FILTERS="arm64-v8a, armeabi-v7a" --stacktrace
            popd
