#	include "Task.h"

namespace Menge
{
	//////////////////////////////////////////////////////////////////////////
	Task::Task()
		: m_complete(false)
		, m_join(false)
		, m_cancel(false)
	{
	}
	//////////////////////////////////////////////////////////////////////////
	Task::~Task()
	{
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::destroy()
	{
		delete this;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::main()
	{
		if( m_cancel == true )
		{
			return false;
		}

		bool state = this->onMain();
		
		m_complete = true;
		return state;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::isComplete() const
	{
		return m_complete;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::isJoin() const
	{
		return m_join;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::isCanceled() const
	{
		return m_cancel;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::onMain()
	{
		bool state = this->_onMain();
        return state;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::_onMain()
	{
        return true;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::onRun()
	{
		for( TVectorTaskListener::iterator
			it = m_listeners.begin(),
			it_end = m_listeners.end();
		it != it_end;
		++it )
		{
			TaskListener * listener = *it;

			listener->onTaskRun( this );
		}
    
		bool state = this->_onRun();
        return state;
	}
	//////////////////////////////////////////////////////////////////////////
	bool Task::_onRun()
	{
		return true;
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::onComplete()
	{
		for( TVectorTaskListener::iterator
			it = m_listeners.begin(),
			it_end = m_listeners.end();
		it != it_end;
		++it )
		{
			TaskListener * listener = *it;

			listener->onTaskComplete( this );
		}

		this->_onComplete();
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::_onComplete()
	{
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::join()
	{
		m_join = true;
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::onJoin()
	{
		this->_onJoin();
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::_onJoin()
	{
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::cancel()
	{
		m_cancel = true;
		this->onCancel();
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::onCancel()
	{
		this->_onCancel();
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::_onCancel()
	{
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::update()
	{
		this->onUpdate();
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::onUpdate()
	{
		this->_onUpdate();
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::_onUpdate()
	{
	}
	//////////////////////////////////////////////////////////////////////////
	void Task::addListener( TaskListener * _listener )
	{
		m_listeners.push_back( _listener );
	}
	//////////////////////////////////////////////////////////////////////////
}