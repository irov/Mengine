apply plugin: 'com.android.library'
import com.trbrmrdr.Ext

android {
    ndkVersion '22.0.7026061'
    buildToolsVersion '31.0.0'
    compileSdkVersion 32

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    defaultConfig {
        minSdkVersion 19
        targetSdkVersion 31
        multiDexEnabled true

    }

    buildTypes {
        debug {
            debuggable true

            externalNativeBuild {
                cmake {
                    arguments "-DANDROID_PLATFORM=android-19",
                            "-DANDROID_ARM_NEON=TRUE",
                            "-DANDROID_STL=c++_shared",
                            "-DANDROID_TOOLCHAIN=clang",
                            "-DANDROID_ALLOW_UNDEFINED_SYMBOLS:BOOLEAN=TRUE",
                            "-DMENGINE_BUILD_MENGINE_MASTER_RELEASE=OFF",
                            "-DMENGINE_BUILD_MENGINE_BUILD_PUBLISH=" + (Ext.GetBooleanProperty(project, "ANDROID_APP_BUILD_PUBLISH", false) ? "ON" : "OFF"),
                            "-DMENGINE_BUILD_MENGINE_DEVELOPMENT=ON",
                            "-DCMAKE_BUILD_TYPE:STRING=Debug"
                }
            }
        }

        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'

            externalNativeBuild {
                cmake {
                    arguments "-DANDROID_PLATFORM=android-19",
                            "-DANDROID_ARM_NEON=TRUE",
                            "-DANDROID_STL=c++_shared",
                            "-DANDROID_TOOLCHAIN=clang",
                            "-DANDROID_ALLOW_UNDEFINED_SYMBOLS:BOOLEAN=TRUE",
                            "-DMENGINE_BUILD_MENGINE_BUILD_PUBLISH=" + (Ext.GetBooleanProperty(project, "ANDROID_APP_BUILD_PUBLISH", false) ? "ON" : "OFF"),
                            "-DMENGINE_BUILD_MENGINE_DEVELOPMENT=OFF",
                            "-DCMAKE_BUILD_TYPE:STRING=Release"
                }
            }
        }
    }

    externalNativeBuild {
        cmake {
            path "../../../cmake/Android_SDL/CMakeLists.txt"
            version "3.18.1"
        }
    }

    preBuild.dependsOn ":libraries:SDL2:build", ":libraries:OpenAL32:build"

    android {
        buildTypes {
            debug {
                buildConfigField "String[]", "MENGINE_GRADLE_ANDROID_PLUGINS", '{}'
            }

            release {
                buildConfigField "String[]", "MENGINE_GRADLE_ANDROID_PLUGINS", '{}'
            }
        }
    }
}

dependencies {
    implementation 'androidx.multidex:multidex:2.0.1'

    implementation 'androidx.appcompat:appcompat:1.4.1'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.3'
    implementation 'androidx.preference:preference:1.2.0'

    implementation project(':libraries:SDL2')
    implementation project(':libraries:OpenAL32')
}
