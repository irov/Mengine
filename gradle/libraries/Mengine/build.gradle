import com.Mengine.Utils

apply plugin: 'com.android.library'

android {
    ndkVersion project.ndkVersion
    buildToolsVersion project.buildToolsVersion
    compileSdkVersion project.compileSdkVersion

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    defaultConfig {
        minSdkVersion project.minSdkVersion
        targetSdkVersion project.targetSdkVersion

        multiDexEnabled true

        if (Utils.getBooleanProperty(project, "ANDROID_APP_SPLIT_ENABLE", false) == false) {
            ndk {
                if (Utils.getBooleanProperty(project, "ANDROID_APP_ARCH_86_64_ENABLE", true) == true) {
                    abiFilters "arm64-v8a", "armeabi-v7a", "x86", "x86_64"
                } else {
                    abiFilters "arm64-v8a", "armeabi-v7a"
                }
            }
        }
    }

    buildTypes {
        debug {

            externalNativeBuild {
                cmake {
                    arguments "-DANDROID_PLATFORM=android-19",
                            "-DANDROID_ARM_NEON=TRUE",
                            "-DANDROID_STL=c++_shared",
                            "-DANDROID_TOOLCHAIN=clang",
                            "-DANDROID_ALLOW_UNDEFINED_SYMBOLS:BOOLEAN=TRUE",
                            "-DMENGINE_BUILD_MENGINE_BUILD_PUBLISH=" + (Utils.getBooleanProperty(project, "ANDROID_APP_BUILD_PUBLISH", false) ? "ON" : "OFF"),
                            "-DMENGINE_BUILD_MENGINE_MASTER_RELEASE=OFF",
                            "-DMENGINE_BUILD_MENGINE_DEVELOPMENT=ON",
                            "-DCMAKE_BUILD_TYPE:STRING=Debug"
                }
            }
        }

        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'

            externalNativeBuild {
                cmake {
                    arguments "-DANDROID_PLATFORM=android-19",
                            "-DANDROID_ARM_NEON=TRUE",
                            "-DANDROID_STL=c++_shared",
                            "-DANDROID_TOOLCHAIN=clang",
                            "-DANDROID_ALLOW_UNDEFINED_SYMBOLS:BOOLEAN=TRUE",
                            "-DMENGINE_BUILD_MENGINE_BUILD_PUBLISH=" + (Utils.getBooleanProperty(project, "ANDROID_APP_BUILD_PUBLISH", false) ? "ON" : "OFF"),
                            "-DMENGINE_BUILD_MENGINE_MASTER_RELEASE=ON",
                            "-DMENGINE_BUILD_MENGINE_DEVELOPMENT=OFF",
                            "-DCMAKE_BUILD_TYPE:STRING=Release"
                }
            }
        }
    }

    externalNativeBuild {
        cmake {
            path "../../../cmake/Android_SDL/CMakeLists.txt"

            version project.cmakeVersion
        }
    }

    preBuild.dependsOn ":libraries:SDL2:build", ":libraries:OpenAL32:build"
}

dependencies {
    implementation 'androidx.multidex:multidex:2.0.1'

    implementation 'androidx.appcompat:appcompat:1.4.2'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
    implementation "androidx.preference:preference:1.2.0"

    implementation project(':libraries:SDL2')
    implementation project(':libraries:OpenAL32')
}
