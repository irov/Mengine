ext.Utils = [:]

Utils.getBooleanProperty = { String name, Boolean d ->
    def p = project.findProperty(name)

    if (p == null) {
        return d
    }

    if (p as Integer == 0) {
        return false
    }

    if (p as Integer == 1) {
        return true
    }

    throw new IllegalArgumentException("Property '${name}' must be 0 or 1, but got '${p}'")

    return d
}

Utils.getStringProperty = { String name, String d ->
    def s = project.findProperty(name)

    if (s == null) {
        return d
    }

    if (s.isEmpty() == true) {
        return null
    }

    if (s.startsWith('"') && s.endsWith('"')) {
        return s.substring(1, s.length() - 1)
    }

    if (s.startsWith("'") && s.endsWith("'")) {
        return s.substring(1, s.length() - 1)
    }

    return s
}

Utils.getIntegerProperty = { String name, Integer d ->
    def p = project.findProperty(name)

    if (p == null) {
        return d
    }

    try {
        def v = p as Integer

        return v
    } catch (ClassCastException e) {
        throw new IllegalArgumentException("Property '${name}' must be integer, but got '${p}'")
    }

    return d
}

Utils.isEnableAllLibrary = { ->
    def enableAll = project.findProperty("MENGINE_APP_LIBRARY_ENABLE_ALL")

    if (enableAll != null && (enableAll as Integer) == 1) {
        return true
    }

    return false
}

Utils.existAppLibrary = { String name ->
    if (Utils.isEnableAllLibrary() == true) {
        return true
    }

    boolean p = Utils.getBooleanProperty(name, true)

    return p
}

Utils.isEnableAllPlugins = { ->
    def enableAll = project.findProperty("MENGINE_APP_PLUGIN_ENABLE_ALL")

    if (enableAll != null && (enableAll as Integer) == 1) {
        return true
    }

    return false
}

Utils.existAppPlugin = { String name, List<String> required = [] ->
    if (Utils.isEnableAllPlugins() == true) {
        return true
    }

    for (String r : required) {
        if (Utils.existAppPlugin(r) == false) {
            return false;
        }
    }

    boolean p = Utils.getBooleanProperty(name, false)

    return p;
}

Utils.getBooleanAppPluginProperty = { String name, List<String> required = [] ->
    if (Utils.isEnableAllPlugins() == true) {
        return true
    }

    for (String r : required) {
        if (Utils.existAppPlugin(r) == false) {
            return false;
        }
    }

    boolean p = Utils.getBooleanProperty(name, false)

    return p
}

Utils.getStringAppPluginProperty = { String name ->
    if (Utils.isEnableAllPlugins() == true) {
        return true
    }

    String p = Utils.getStringProperty(name)

    return p
}

Utils.getIntegerAppPluginProperty = { String name ->
    if (Utils.isEnableAllPlugins() == true) {
        return true
    }

    Integer p = Utils.getIntegerProperty(name)

    return p
}

Utils.existAppService = { String name ->
    boolean p = Utils.getBooleanProperty(name, true)

    return p
}

Utils.logAvailable = { String name, boolean value ->
    if (value == false) {
        println "\u001b[31m${name}: ${value}\u001b[0m"
    } else {
        println "\u001b[32m${name}: ${value}\u001b[0m"
    }
}

Utils.logString = { String name, String value ->
    println "\u001b[33m${name}: ${value}\u001b[0m"
}

Utils.logInteger = { String name, int value ->
    println "\u001b[33m${name}: ${value}\u001b[0m"
}