ext.Utils = [:]

Utils.getBooleanProperty = { final String name, final Boolean d ->
    final def p = project.findProperty(name)

    if (p == null) {
        return d
    }

    try {
        if (p as Integer == 0) {
            return false
        }

        if (p as Integer == 1) {
            return true
        }

        throw new IllegalArgumentException("Property '${name}' must be 0/1 or true/false, but got '${p}'")
    } catch (final Exception ignored) {
    }

    final def s = p.toString().trim().toLowerCase()

    if (s == "true") {
        return true
    }

    if (s == "false") {
        return false
    }

    throw new IllegalArgumentException("Property '${name}' must be 0/1 or true/false, but got '${p}'")
}

Utils.getStringProperty = { final String name, final String d ->
    final def s = project.findProperty(name)

    if (s == null) {
        return d
    }

    if (s.isEmpty() == true) {
        return null
    }

    if (s.startsWith('"') && s.endsWith('"')) {
        return s.substring(1, s.length() - 1)
    }

    if (s.startsWith("'") && s.endsWith("'")) {
        return s.substring(1, s.length() - 1)
    }

    return s
}

Utils.getIntegerProperty = { final String name, final Integer d ->
    final def p = project.findProperty(name)

    if (p == null) {
        return d
    }

    try {
        final def v = p as Integer

        return v
    } catch (final ClassCastException e) {
        throw new IllegalArgumentException("Property '${name}' must be integer, but got '${p}' [exception: ${e}]")
    }
}

Utils.isEnableAllLibrary = { -> Boolean
    return Utils.getBooleanProperty("MENGINE_APP_LIBRARY_ENABLE_ALL", false)
}

Utils.existAppLibrary = { final String name ->
    if (Utils.isEnableAllLibrary() == true) {
        return true
    }

    final boolean p = Utils.getBooleanProperty(name, true)

    return p
}

Utils.isEnableAllPlugins = { ->
    return Utils.getBooleanProperty("MENGINE_APP_PLUGIN_ENABLE_ALL", false)
}

Utils.existAppPlugin = { final String name, final List<String> required = [] ->
    if (Utils.isEnableAllPlugins() == true) {
        return true
    }

    for (final String r : required) {
        if (Utils.existAppPlugin(r) == false) {
            return false
        }
    }

    final boolean p = Utils.getBooleanProperty(name, false)

    return p
}

Utils.getBooleanAppPluginProperty = { final String name, final List<String> required = [] ->
    if (Utils.isEnableAllPlugins() == true) {
        return true
    }

    for (final String r : required) {
        if (Utils.existAppPlugin(r) == false) {
            return false
        }
    }

    final boolean p = Utils.getBooleanProperty(name, false)

    return p
}

Utils.existAppService = { final String name ->
    final boolean p = Utils.getBooleanProperty(name, true)

    return p
}

final String RED = "\u001b[31m"
final String GREEN = "\u001b[32m"
final String YELLOW = "\u001b[33m"
final String RESET = "\u001b[0m"

Utils.logAvailable = { final String name, final boolean value ->
    if (value == false) {
        println RED + "${name}: ${value}" + RESET
    } else {
        println GREEN + "${name}: ${value}" + RESET
    }
}

Utils.logString = { final String name, final String value ->
    println YELLOW + "${name}: ${value}" + RESET
}

Utils.logInteger = { final String name, final int value ->
    println YELLOW + "${name}: ${value}" + RESET
}