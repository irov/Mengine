#	include "SoundNode.h"

#	include "ObjectImplement.h"

#	include "SoundSystemInterface.h"
#	include "SoundEngine.h"

#	include "XmlParser.h"
#	include "FileEngine.h"

//////////////////////////////////////////////////////////////////////////
OBJECT_IMPLEMENT(SoundNode);
//////////////////////////////////////////////////////////////////////////
SoundNode::SoundNode()
: m_interface(NULL)
{}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::play()
{
	m_interface->play();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::pause()
{
	m_interface->pause();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::stop()
{
	m_interface->stop();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::setLooped(bool _flag)
{
	m_interface->setLooped(_flag);
}
//////////////////////////////////////////////////////////////////////////
bool		SoundNode::getLooped() const
{
	return	m_interface->getLooped();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::setVolume(float _value)
{
	m_interface->setVolume(_value);
}
//////////////////////////////////////////////////////////////////////////
float		SoundNode::getVolume() const
{
	return	m_interface->getVolume();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::setPosition(const mt::vec2f& _position)
{
	m_interface->setPosition(_position.m);
}
//////////////////////////////////////////////////////////////////////////
mt::vec2f	SoundNode::getPosition() const
{
	const float* pos = m_interface->getPosition();
	return mt::vec2f(pos[0],pos[1]);
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::setMaxDistance(float dist)
{
	m_interface->setMaxDistance(dist);
}
//////////////////////////////////////////////////////////////////////////
float		SoundNode::getMaxDistance() const
{
	return m_interface->getMaxDistance();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::setHeadMode(bool flag)
{
	m_interface->setHeadMode(flag);
}
//////////////////////////////////////////////////////////////////////////
bool		SoundNode::updateSoundBuffer()
{
	return m_interface->updateSoundBuffer();
}
//////////////////////////////////////////////////////////////////////////
bool		SoundNode::getHeadMode() const
{
	return	m_interface->getHeadMode();
}
//////////////////////////////////////////////////////////////////////////
bool		SoundNode::isPlaying() const
{
	return	m_interface->isPlaying();
}
//////////////////////////////////////////////////////////////////////////
double		SoundNode::getTotalSize()	const
{
	return	m_interface->getTotalSize();
}
//////////////////////////////////////////////////////////////////////////
double		SoundNode::getPos()	const
{
	return	m_interface->getPos();
}
//////////////////////////////////////////////////////////////////////////
void	SoundNode::_update(float _timing)
{
	m_interface->updateSoundBuffer();
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::loader(TiXmlElement * xml)
{
	XML_FOR_EACH_TREE(xml)
	{
		XML_CHECK_VALUE_NODE("Filename","Value",m_filename);
	}
}
//////////////////////////////////////////////////////////////////////////
bool		SoundNode::_compile()
{
	Keeper<SoundEngine>::hostage()->addSoundNode(m_interface,m_fileData,m_filename,false);
	//play(); //for test
	return	true;
}
//////////////////////////////////////////////////////////////////////////
void		SoundNode::_release()
{
	Keeper<SoundEngine>::hostage()->deleteSound(m_interface);
	Keeper<FileEngine>::hostage()->closeFile(m_fileData);
}