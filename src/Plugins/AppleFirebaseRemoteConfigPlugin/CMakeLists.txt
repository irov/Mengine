MENGINE_PROJECT(AppleFirebaseRemoteConfigPlugin)

IF(NOT MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_PATH)
    MESSAGE(FATAL_ERROR "Apple Firebase RemoteConfig required setup MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_PATH")
ENDIF()

get_filename_component(MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_NAME ${MENGINE_DEPLOY_PATH}/${MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_PATH} NAME_WE)

MESSAGE("Apple Firebase RemoteConfig plist path: ${MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_PATH}")
MESSAGE("Apple Firebase RemoteConfig plist name: ${MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_NAME}")

ADD_FILTER(
src
    AppleFirebaseRemoteConfigInterface.h

    AppleFirebaseRemoteConfigPlugin.h
    AppleFirebaseRemoteConfigPlugin.mm
    
    AppleFirebaseRemoteConfigApplicationDelegate.h
    AppleFirebaseRemoteConfigApplicationDelegate.mm
    
    AppleFirebaseRemoteConfigService.h
    AppleFirebaseRemoteConfigService.mm
)

if(MENGINE_USE_SCRIPT_SERVICE)
    ADD_FILTER(
    embedding
        AppleFirebaseRemoteConfigScriptEmbedding.h
        AppleFirebaseRemoteConfigScriptEmbedding.mm
        )
        
    INCLUDE_DIRECTORIES(${THIRDPARTY_DIR}/pybind/include)
endif()

ADD_DEFINITIONS(-DMENGINE_FIREBASE_REMOTECONFIG_PLIST_NAME="${MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_NAME}")

ADD_MENGINE_APPLE_PLUGIN(MENGINE_PLUGIN_APPLE_FIREBASE_REMOTECONFIG)

ADD_MENGINE_COCOAPOD_GOOGLE_UTILITIES()
ADD_MENGINE_COCOAPOD("FirebaseRemoteConfig" "NO-GIT" "11.5.0")

ADD_MENGINE_APPLE_APPLICATION_DELEGATE("AppleFirebaseRemoteConfigApplicationDelegate")



ADD_MENGINE_APPLE_RESOURCES(${MENGINE_APPLICATION_DEPLOY_FIREBASE_REMOTECONFIG_PLIST_PATH})

if(MENGINE_USE_SCRIPT_SERVICE)
    TARGET_LINK_LIBRARIES(${PROJECT_NAME} Python)
endif()
