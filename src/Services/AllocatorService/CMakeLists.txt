MENGINE_PROJECT(AllocatorService)

OPTION(MENGINE_SUPPORT_RPMALLOC "Mengine use rpmalloc for allocation" ON)

if(MENGINE_TARGET_ANDROID)
    SET(MENGINE_SUPPORT_RPMALLOC OFF)
elseif(MENGINE_TARGET_MACOS)
    SET(MENGINE_SUPPORT_RPMALLOC OFF)
elseif(MENGINE_TARGET_IOS)
    SET(MENGINE_SUPPORT_RPMALLOC OFF)
elseif(MENGINE_TARGET_IOS_SIMULATOR)
    SET(MENGINE_SUPPORT_RPMALLOC OFF)
endif()

ADD_FILTER(
src
    AllocatorService.h
    AllocatorService.cpp
)

if(NOT MENGINE_SUPPORT_RPMALLOC)
    ADD_DEFINITIONS(-DMENGINE_ALLOCATOR_RPMALLOC=0)
endif()

if(MENGINE_SUPPORT_RPMALLOC)
    INCLUDE_DIRECTORIES(${THIRDPARTY_DIR}/rpmalloc)
endif()

ADD_MENGINE_LIBRARY(Services)

if(MENGINE_SUPPORT_RPMALLOC)
    TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${THIRDPARTY_LIB_DIR}/${MENGINE_LIB_PREFIX}rpmalloc${MENGINE_LIB_SUFFIX})
endif()