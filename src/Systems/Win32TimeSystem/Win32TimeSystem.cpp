#include "Win32TimeSystem.h"

#include "Environment/Windows/WindowsIncluder.h"

//////////////////////////////////////////////////////////////////////////
SERVICE_FACTORY( TimeSystem, Mengine::Win32TimeSystem );
//////////////////////////////////////////////////////////////////////////
namespace Mengine
{
    //////////////////////////////////////////////////////////////////////////
    Win32TimeSystem::Win32TimeSystem()
    {
    }
    //////////////////////////////////////////////////////////////////////////
    Win32TimeSystem::~Win32TimeSystem()
    {
    }
    //////////////////////////////////////////////////////////////////////////
    bool Win32TimeSystem::_initializeService()
    {
        return true;
    }
    //////////////////////////////////////////////////////////////////////////
    void Win32TimeSystem::_finalizeService()
    {
        //Empty
    }
    //////////////////////////////////////////////////////////////////////////
    Timestamp Win32TimeSystem::getSystemTimestamp() const
    {
        FILETIME ft;
        ::GetSystemTimeAsFileTime( &ft );

        ULARGE_INTEGER ui;
        ui.LowPart = ft.dwLowDateTime;
        ui.HighPart = ft.dwHighDateTime;

        Timestamp timestamp = (ui.QuadPart / 10000ULL) - 11644473600000ULL;

        return timestamp;
    }
    //////////////////////////////////////////////////////////////////////////
}
